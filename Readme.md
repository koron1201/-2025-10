# ビジネスメールAIアプリ

## プロジェクト概要

ビジネスメールの作成をAIが支援するアプリケーションです。特定のキーワードからメール内容を自動生成し、時候の挨拶や書式の提案、過去の文章記録による重複防止、外部アプリとの連携機能を提供します。

## 主要機能

### 基本機能
- **キーワード入力によるメール自動生成**: 特定のキーワードを入力すると、AIがメールの内容を作成
- **時候の挨拶・書式提案**: ビジネスシーンに適した挨拶文やメール書式の自動提案
- **履歴保存と重複防止**: 過去の文章を記録し、メール文の重複を防止
- **外部アプリ連携**: Slack、Outlook、Googleカレンダーなどとの連携

### 独自機能（コンテキストAI）
- **業界特化型テンプレート**: 職種（セールス、カスタマーサポート、人事、開発）ごとの専門テンプレート
- **パーソナライズされたサジェスト**: ユーザーの職種や部署に応じた表現・テンプレートの優先順位調整
- **社内文化学習**: 組織特有の言葉遣いや表現を学習し、自然なコミュニケーションを促進

### 追加機能（GPT提案）
- **感情分析とトーン調整**: メールの感情的なトーンを分析し、ビジネスシーンに適切な表現に自動調整
- **多言語対応とリアルタイム翻訳**: 主要言語への自動翻訳と文化的なビジネスマナー考慮
- **相手の性格・役職分析**: 過去のメール履歴から相手の特徴を分析し、最適な敬語レベルや表現スタイルを提案
- **音声入力とリアルタイム文字起こし**: 音声でメール内容を入力し、ビジネスメール形式に自動整形
- **スケジュール統合と自動日程調整**: Googleカレンダーと連携し、会議の空き時間を自動で探して調整メールを生成
- **AIによる緊急度・重要度判定**: 受信メールの緊急度を自動判定し、返信期限を提案

## 技術スタック

- **フロントエンド**: React.js
- **バックエンド**: Java (Spring Boot)
- **データベース**: MySQL/PostgreSQL
- **バージョン管理**: Git

## 開発ロードマップ

### 1. プロジェクト初期設定
- [ ] React.jsプロジェクトのセットアップ（Create React App/Vite）
- [ ] Spring Bootプロジェクトの作成（Maven/Gradle）
- [ ] データベースのセットアップ（MySQL/PostgreSQL）
- [ ] Gitリポジトリの初期化

### 2. MVP（最小限の機能）開発
- [ ] **メール生成API** (`POST /api/emails/generate`)
  - キーワードからAIモデル（OpenAI API/Vertex AI）を呼び出してメール本文を生成
- [ ] **履歴保存API** (`POST /api/emails/history`)
  - 作成されたメールをデータベースに保存
- [ ] **フロントエンドUI**
  - キーワード入力テキストボックス
  - 「メールを作成」ボタン
  - 生成されたメール本文の表示画面
- [ ] **API連携**
  - フロントエンドとバックエンドの連携処理

### 3. 主要機能の追加開発
- [ ] **時候の挨拶・書式テンプレート機能**
  - `GET /api/templates/greetings` APIの実装
  - 季節や目的に応じた挨拶文のデータベース管理
  - フロントエンドでの挨拶文選択UI
- [ ] **重複防止機能**
  - 履歴APIの拡張（類似度比較ロジック）
  - 重複検出時の警告表示UI
- [ ] **外部アプリ連携機能**
  - Slack Web API連携 (`POST /api/integrations/slack`)
  - Microsoft Graph API連携（Outlook）
  - Google Calendar API連携
  - 連携設定画面とワンクリック送信機能

### 4. 独自機能（コンテキストAI）の実装
- [ ] **業界・職種特化型テンプレート**
  - 職種別テンプレートのデータベース設計
  - 初期設定での職種選択機能
- [ ] **パーソナライズされたサジェスト機能**
  - ユーザー職種・履歴分析ロジック
  - AIモデルのファインチューニング
- [ ] **社内文化学習機能**
  - Slack/Outlook連携データの分析
  - 組織特有の表現学習システム

### 5. テストとデプロイ
- [ ] **テスト**
  - ユニットテスト
  - 結合テスト
  - UIテスト
- [ ] **デプロイ**
  - バックエンド: Heroku/AWS Elastic Beanstalk/Google App Engine
  - フロントエンド: Vercel/Netlify/AWS S3 + CloudFront

## API設計

| API名 | 概要 | メソッド・パス | リクエスト例 | レスポンス例 |
|-------|------|----------------|--------------|--------------|
| メール生成API | メール文自動生成 | `POST /api/emails/generate` | `{ keywords: [], recipient: ... }` | `{ subject, body }` |
| 挨拶&書式API | 挨拶・書式テンプレート取得 | `GET /api/templates/greetings` | `{ season, region }` | `{ greeting }` |
| 履歴保存API | 作成メール文の保存と重複判定 | `POST /api/emails/history` | `{ userId, emailBody }` | `{ historyId, isDuplicate }` |
| 連携API | Slack/Outlook連携 | `POST /api/integrations/slack` | `{ message, channelId }` | `{ status }` |
| 感情分析API | メール内容トーン分析・修正案 | `POST /api/emails/analyze-tone` | `{ body }` | `{ score, suggestedBody }` |
| 翻訳API | メール内容の自動翻訳 | `POST /api/emails/translate` | `{ body, targetLang }` | `{ translatedBody }` |
| パーソナリティ分析API | 相手特徴解析・敬語/スタイル提案 | `POST /api/personality/analyze` | `{ recipientEmail, emailHistory }` | `{ persona, toneSuggestion }` |
| 音声入力API | 音声→テキスト変換 | `POST /api/emails/speech-to-text` | `{ audioFile }` | `{ text }` |
| スケジュールAPI | 会議自動調整メール生成 | `POST /api/schedule/meetings` | `{ calendarId, attendees }` | `{ suggestedSlots, emailDraft }` |
| 緊急度判定API | メール重要度・期限判定 | `POST /api/emails/urgency` | `{ subject, body }` | `{ urgencyLevel, deadline }` |
| フォローアップAPI | 重要メール自動フォロー設定 | `POST /api/emails/followup` | `{ emailId }` | `{ reminderDate }` |

---

## フロントエンドの起動手順（Vite）

1. 依存インストール
   - `cd frontend/frontend`
   - `npm ci` または `npm install`
2. モックモードで起動（バックエンド不要）
   - いずれかを設定
     - `.env` に `VITE_USE_MOCK=true` を記述
     - もしくは起動時 `VITE_USE_MOCK=true npm run dev`
   - `npm run dev`
3. ブラウザで表示
   - 表示URLは起動ログを参照（例: `http://localhost:5173/`）

### モックモードでできること
- キーワードからのメール生成（モック文面）
- 履歴保存（重複疑似判定）
- Slack/Outlook/Googleカレンダー連携の擬似レスポンス
- コンテキストAI
  - 職種に応じたテンプレート取得（クリックで本文に追記）
  - トーン・部署・社内文化を考慮したサジェスト（件名/本文の修正案 + ヒント）

### 本番APIに接続する場合
- `.env` の `VITE_USE_MOCK=false`
- バックエンドの各エンドポイントに合わせ、フロント `fetch` のベースパス/プロキシ設定（`vite.config.ts`）を調整

---

## 画面の使い方

1. 受信者（任意）とキーワード（カンマ区切り）を入力
2. 「メールを作成」を押下
3. 生成結果が表示されたら、必要に応じて「履歴に保存」
4. 「外部アプリに共有」タブで Slack/Outlook/カレンダー連携
5. 「コンテキストAI」
   - 職種/トーン/部署/社内文化を入力
   - 「テンプレート取得」で候補一覧が表示され、クリックで本文に追記
   - 「サジェスト」で件名/本文の改善案とヒントが表示され「反映」で適用

### 入力ヒント
- キーワードは 2〜5 個程度だと精度が安定
- 受信者を入れると宛名行が自動付与（モックでも簡易対応）
- サジェストは既存本文を破壊せず、適用ボタンで明示反映

### 主要な競合サービス
- **WriteMail.ai**: メール自動生成・翻訳・トーン調整、Gmail連携
- **Lindy.ai**: Gmail/カレンダー/Slack連携、自動化、緊急度判定
- **EaseMate AI**: キーワード入力で内容生成・履歴管理
- **BeLikeNative**: 感情・トーン分析、穏やか・建設的な表現に自動改善
- **Crystal Knows**: 相手パーソナリティ分析・敬語推奨、LinkedIn連携

## 開発メモ

- i18n: `src/lib/i18n.ts` に文言、`contexts/LanguageContext.tsx` で切替
- APIクライアント: `src/lib/apiClient.ts`
- 型: `src/types/api.ts`
- モック: `src/lib/mocks.ts`
- メイン画面: `src/App.tsx` / スタイル: `src/App.css`

---

## 既知の注意点

- テンプレートやサジェストはモックモード時に固定/簡易ロジック
- 本番接続時はCORSと認証（Slack/MS Graph/Google）設定が必要
- レイアウトは 1280px+ を想定。幅が極端に狭い場合は崩れを避けるためにブラウザ幅を広げてください




## 使用方法
### アプリ全体
- 現在の画面構成
  - **ヘッダー**（ロゴ、検索、言語切替、ヘルプ/設定/アプリ/アバター）
  - **左サイドバー**（作成、受信トレイ/スター/スヌーズ/送信済み/下書き、Meet、ハングアウト）
  - **メイン**（ツールバー、コンテンツ：メール作成ビュー or メール一覧ビュー）
  - **右アプリバー**（アイコン群：装飾）
- 2つの主ビュー
  - **作成ビュー**: メール生成/保存、コンテキストAI、外部共有（Slack/Outlook/Calendar）
  - **メールボックスビュー**: 受信/スター/スヌーズ/送信/下書きの閲覧・簡易操作

### 言語切替（i18n）
- できること: 表示言語を `日本語/English/한국어/中文` から切替（永続化されます）。
- 使い方:
  - ヘッダー右の「🌐」ボタン → ドロップダウンから言語を選択。
  - 選択は `localStorage('wamail-language')` に保存。既定はブラウザ言語。

### 検索欄（ヘッダー）
- できること: 件名・本文を横断して即時フィルタ（全フォルダ対象）。
- 使い方:
  - ヘッダー中央の検索ボックスに文字を入力すると、メール一覧ビューに切替し、全メール（受信/送信/下書き/スター/スヌーズ含む）から件名・本文の部分一致で絞り込み表示。
  - 入力を消すと通常のフォルダ別リスト表示に戻ります。

### メール作成・AI生成
- できること:
  - キーワードと任意の受信者から、メール件名/本文を自動生成。
  - 生成結果の表示・固定（結果は読み取り専用）。
- 使い方:
  - 左サイドバーの「作成」またはメール一覧でメールをクリックして作成ビューへ。
  - フォーム
    - 受信者（任意）
    - キーワード（カンマ区切り）…1語以上で「メールを作成」ボタンが有効化
  - 「メールを作成」を押すと生成開始。`VITE_USE_MOCK==='true'` ならモック生成、そうでなければ `/api/emails/generate` にPOST。
  - 生成結果は「件名」「本文」に表示（本文はテキストエリア・読み取り専用）。

### 履歴保存（重複警告あり）
- できること: 生成結果を履歴へ保存。重複疑い時に警告を表示。
- 使い方:
  - 生成後、「履歴に保存」を押すと保存（`/api/emails/history` またはモック）。
  - 結果表示
    - 既存類似あり: 画面上に警告表示＋アラートで注意喚起
    - 保存成功: 画面上に「保存しました」

### コンテキストAI（テンプレート・サジェスト）
- できること:
  - 職種/トーン/部署/社内文化を指定してテンプレート取得・挿入。
  - 生成結果に基づく件名/本文の改善案とヒントを提示し、ワンクリック適用。
- 使い方:
  - セクション内の設定
    - 職種（営業/サポート/人事/開発）
    - トーン（フォーマル/ニュートラル/フレンドリー）
    - 部署（任意）
    - 社内文化（任意）
  - 「テンプレート取得」→ 一覧が表示 → テンプレートをクリックすると本文の先頭に挿入（件名は空のときのみ上書き）。
  - 「サジェスト」→ 件名/本文案とヒント表示 → 「反映」で結果に適用。
  - いずれも `VITE_USE_MOCK==='true'` ならフロントだけで擬似応答。オフなら `/api/context/...` にPOST。

### 外部共有（Slack / Outlook / Google Calendar）
- Slack
  - できること: 生成した件名+本文（+任意追記）をチャンネルへ送信。
  - 使い方:
    - タブ「Slack」を選択。
    - 「チャンネルID」（例: `general`/`C0123456`）、任意の追記メッセージを入力。
    - 「Slackに送信」を押す → 成否ステータスを表示。
- Outlook
  - できること: 宛先を指定してメールを送信。
  - 使い方:
    - タブ「Outlook」を選択。
    - 宛先メールアドレスを入力して「Outlookで送信」。
    - 成否ステータスを表示。
- Google Calendar
  - できること: イベント作成（タイトル/開始/終了/参加者/説明=本文）。
  - 使い方:
    - タブ「Google Calendar」を選択。
    - タイトル（未入力なら件名が既定）、開始/終了日時、参加者（カンマ区切り）を入力。
    - 「予定を作成」を押す → 成否ステータスを表示。
- 備考:
  - いずれも `VITE_USE_MOCK==='true'` でモック応答。オフ時は `/api/integrations/...` にPOST。
  - Slackは本文末尾へ任意メッセージを追記して送信。

### メールボックス閲覧（受信/スター/スヌーズ/送信/下書き）
- できること:
  - 左ナビで `受信/スター付き/スヌーズ中/送信済み/下書き` を切替。
  - メール行の操作
    - スターの切替
    - 明日までスヌーズ/スヌーズ解除
    - 「開く」で作成ビューへ（件名/本文を結果に読み込み）
- 使い方:
  - 左ナビでフォルダを選ぶと中央リストが切替。
  - メールをクリック、または「開く」で作成ビューに遷移し内容を編集ベースとして活用。
- データ保持:
  - 初回起動時にサンプルメールを投入。
  - 変更は `localStorage('wamail-mails')` に自動保存。
  - 受信トレイのカウントは「スヌーズ中」を除外して算出。

### Google Meet 連携（新規/参加）
- できること:
  - 新規Meetを新規タブで開く。
  - 会議コード/URLから参加。
- 使い方:
  - 左サイドバー「Meet」
    - 「新しい会議」→ 確認モーダルの「新しいタブで開く」で `https://meet.google.com/new` を開く。
    - 「会議に参加」→ モーダルでコード（例 `abc-defg-hij`）またはURLを入力 → 「参加」で新規タブを開く。

### 簡易チャット（メール送信ベース）
- できること:
  - 相手アドレスとメッセージを指定すると、環境に応じた方法で「メールとして」送信し、画面内のチャットログと送信済みに反映。
- 使い方:
  - 左サイドバー「ハングアウト」→ 「新しいチャットを開始」。
  - モーダルで相手のメール、メッセージを入力 → 「送信」。
  - 送信方法の優先順位
    1) `VITE_MAIL_COMPOSE='gmail'` → Gmailの作成画面を新規タブで開く
    2) `VITE_USE_MAILTO='true'` → `mailto:` を開く
    3) それ以外 → Outlook連携APIで送信
  - 送信成功時、`送信済み` に追加、モーダル内の履歴にも追記。

### ツールバー・右アプリバー（装飾）
- できること: ツールバーの各種ボタン（アーカイブ/報告/削除/未読/スヌーズ/完了/移動/ラベル/その他/前へ/次へ/言語）と右アプリバーのアイコンはUIのみ。クリック動作は現状未実装。
- 使い方: 装飾のため操作不要。

### 永続化・環境変数（動作モード）
- 永続化
  - `wamail-mails`: メール一覧の状態
  - `wamail-language`: 選択言語
- 環境変数（Vite）
  - `VITE_USE_MOCK`… `'true'` で全APIをフロントモックに切替（バックエンド不要・画面に「モックモード」表示）
  - `VITE_MAIL_COMPOSE`… `'gmail'` で Gmail作成画面を開く
  - `VITE_USE_MAILTO`… `'true'` で `mailto:` を使用

### ナビゲーションの基本
- 左の「作成」でメール作成ビューへ。
- 左の各フォルダでメール一覧ビューへ。
- 一覧からメールを開くと、作成ビューに件名/本文が投入されます。

— 以上が、実装されている全UI機能とその使い方です（ボタンの有効/無効条件も各セクションに反映済みです）。

- 履歴
  - 「メールを作成」はキーワードが1つ以上で有効化。
  - 「履歴に保存」は生成結果がある時のみ有効。
  - 「Outlookで送信」は宛先入力で有効。
  - 「会議に参加」はコード/URL入力で有効。

- エラー表示
  - 失敗時はフォーム下にエラーメッセージが表示されます（Slack/Outlook/Calendar/保存/サジェストなど共通）。

短いまとめ:
- メール生成/保存、コンテキストAI（テンプレ/サジェスト）、外部共有（Slack/Outlook/Calendar）、メールボックス操作（スター/スヌーズ/開く）、Meet新規/参加、簡易チャット、言語切替を備えています。
- `VITE_USE_MOCK` でバックエンド不要運用、送信系は環境変数でGmail/mailto/Outlookを自動選択します。